lib/
â”œâ”€â”€ main.dart                           # App entry point

# ==== CORE ARCHITECTURE ====
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â”œâ”€â”€ app_constants.dart         # App-wide constants (colors, sizes, etc.)
â”‚   â”‚   â”œâ”€â”€ audio_constants.dart       # Audio settings (sample rates, bitrates)
â”‚   â”‚   â””â”€â”€ storage_constants.dart     # File paths, database constants
â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â”œâ”€â”€ audio_format.dart          # AudioFormat enum (WAV, M4A, FLAC) âœ… CREATE THIS
â”‚   â”‚   â”œâ”€â”€ folder_type.dart           # FolderType enum (default, custom) âœ… CREATE THIS
â”‚   â”‚   â”œâ”€â”€ recording_quality.dart     # Quality settings enum
â”‚   â”‚   â”œâ”€â”€ sort_type.dart             # Sorting options enum
â”‚   â”‚   â””â”€â”€ view_type.dart             # View types enum (grid, list)
â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â”œâ”€â”€ audio_exceptions.dart      # Custom audio-related exceptions
â”‚   â”‚   â”œâ”€â”€ storage_exceptions.dart    # File/database exceptions
â”‚   â”‚   â””â”€â”€ permission_exceptions.dart # Permission-related exceptions
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ date_formatter.dart        # Date/time formatting utilities
â”‚   â”‚   â”œâ”€â”€ file_utils.dart           # File operations helper
â”‚   â”‚   â”œâ”€â”€ audio_utils.dart          # Audio format conversion, validation
â”‚   â”‚   â””â”€â”€ duration_formatter.dart    # Audio duration formatting
â”‚   â””â”€â”€ extensions/
â”‚       â”œâ”€â”€ string_extensions.dart     # String helper methods
â”‚       â”œâ”€â”€ datetime_extensions.dart   # DateTime helper methods
â”‚       â””â”€â”€ duration_extensions.dart   # Duration formatting extensions

# ==== DATA LAYER ====
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ folder_model.dart          # Folder data model
â”‚   â”‚   â”œâ”€â”€ recording_model.dart       # Recording data model
â”‚   â”‚   â”œâ”€â”€ app_settings_model.dart    # App settings model
â”‚   â”‚   â””â”€â”€ metadata_model.dart        # Audio metadata model
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ database_helper.dart       # SQLite database setup
â”‚   â”‚   â”œâ”€â”€ tables/
â”‚   â”‚   â”‚   â”œâ”€â”€ folders_table.dart     # Folders table schema
â”‚   â”‚   â”‚   â”œâ”€â”€ recordings_table.dart  # Recordings table schema
â”‚   â”‚   â”‚   â””â”€â”€ settings_table.dart    # Settings table schema
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚       â””â”€â”€ migration_v1_to_v2.dart # Future database migrations
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ folder_repository.dart     # Folder CRUD operations
â”‚   â”‚   â”œâ”€â”€ recording_repository.dart  # Recording CRUD operations
â”‚   â”‚   â”œâ”€â”€ settings_repository.dart   # Settings CRUD operations
â”‚   â”‚   â””â”€â”€ file_repository.dart       # File system operations
â”‚   â””â”€â”€ datasources/
â”‚       â”œâ”€â”€ local/
â”‚       â”‚   â”œâ”€â”€ folder_local_datasource.dart   # Local folder operations
â”‚       â”‚   â”œâ”€â”€ recording_local_datasource.dart # Local recording operations
â”‚       â”‚   â””â”€â”€ file_local_datasource.dart     # Local file operations
â”‚       â””â”€â”€ external/
â”‚           â”œâ”€â”€ audio_recorder_datasource.dart # Audio recording interface
â”‚           â”œâ”€â”€ audio_player_datasource.dart   # Audio playback interface
â”‚           â””â”€â”€ file_picker_datasource.dart    # Import files interface

# ==== BUSINESS LOGIC LAYER ====
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ folder_entity.dart         # Pure folder business object âœ… CREATE THIS
â”‚   â”‚   â”œâ”€â”€ recording_entity.dart      # Pure recording business object
â”‚   â”‚   â””â”€â”€ app_settings_entity.dart   # Pure settings business object
â”‚   â”œâ”€â”€ usecases/
â”‚   â”‚   â”œâ”€â”€ folder/
â”‚   â”‚   â”‚   â”œâ”€â”€ create_folder_usecase.dart      # Create custom folder
â”‚   â”‚   â”‚   â”œâ”€â”€ delete_folder_usecase.dart      # Delete custom folder
â”‚   â”‚   â”‚   â”œâ”€â”€ get_folders_usecase.dart        # Get all folders
â”‚   â”‚   â”‚   â””â”€â”€ update_folder_count_usecase.dart # Update folder counts
â”‚   â”‚   â”œâ”€â”€ recording/
â”‚   â”‚   â”‚   â”œâ”€â”€ start_recording_usecase.dart    # Start new recording
â”‚   â”‚   â”‚   â”œâ”€â”€ stop_recording_usecase.dart     # Stop recording
â”‚   â”‚   â”‚   â”œâ”€â”€ pause_recording_usecase.dart    # Pause/resume recording
â”‚   â”‚   â”‚   â”œâ”€â”€ play_recording_usecase.dart     # Play recording
â”‚   â”‚   â”‚   â”œâ”€â”€ delete_recording_usecase.dart   # Delete recording
â”‚   â”‚   â”‚   â”œâ”€â”€ import_recording_usecase.dart   # Import external file
â”‚   â”‚   â”‚   â”œâ”€â”€ export_recording_usecase.dart   # Export/share recording
â”‚   â”‚   â”‚   â”œâ”€â”€ search_recordings_usecase.dart  # Search functionality
â”‚   â”‚   â”‚   â”œâ”€â”€ filter_recordings_usecase.dart  # Filter by criteria
â”‚   â”‚   â”‚   â”œâ”€â”€ move_recording_usecase.dart     # Move between folders
â”‚   â”‚   â”‚   â””â”€â”€ bulk_operations_usecase.dart    # Bulk delete/move
â”‚   â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â”‚   â”œâ”€â”€ convert_format_usecase.dart     # Convert audio formats
â”‚   â”‚   â”‚   â”œâ”€â”€ trim_audio_usecase.dart         # Trim audio file
â”‚   â”‚   â”‚   â”œâ”€â”€ merge_audio_usecase.dart        # Merge multiple files
â”‚   â”‚   â”‚   â””â”€â”€ adjust_quality_usecase.dart     # Change quality settings
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚       â”œâ”€â”€ update_audio_format_usecase.dart # Change default format
â”‚   â”‚       â”œâ”€â”€ update_quality_usecase.dart      # Change quality settings
â”‚   â”‚       â””â”€â”€ get_settings_usecase.dart        # Get current settings
â”‚   â””â”€â”€ repositories/
â”‚       â”œâ”€â”€ i_folder_repository.dart            # Folder repository interface
â”‚       â”œâ”€â”€ i_recording_repository.dart         # Recording repository interface
â”‚       â”œâ”€â”€ i_settings_repository.dart          # Settings repository interface
â”‚       â””â”€â”€ i_audio_service_repository.dart     # Audio service interface

# ==== PRESENTATION LAYER ====
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ blocs/                          # âš ï¸ CORRECTED: Changed from "providers" to "blocs"
â”‚   â”‚   â”œâ”€â”€ folder/
â”‚   â”‚   â”‚   â”œâ”€â”€ folder_bloc.dart       # Folder state management âœ… CREATE THIS
â”‚   â”‚   â”‚   â”œâ”€â”€ folder_event.dart      # Folder events âœ… CREATE THIS
â”‚   â”‚   â”‚   â””â”€â”€ folder_state.dart      # Folder states âœ… CREATE THIS
â”‚   â”‚   â”œâ”€â”€ recording/
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_bloc.dart    # Recording state management
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_event.dart   # Recording events
â”‚   â”‚   â”‚   â””â”€â”€ recording_state.dart   # Recording states
â”‚   â”‚   â”œâ”€â”€ audio_player/
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_player_bloc.dart # Audio playback state
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_player_event.dart# Audio player events
â”‚   â”‚   â”‚   â””â”€â”€ audio_player_state.dart# Audio player states
â”‚   â”‚   â”œâ”€â”€ audio_recorder/
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_recorder_bloc.dart # Recording session state
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_recorder_event.dart# Recorder events
â”‚   â”‚   â”‚   â””â”€â”€ audio_recorder_state.dart# Recorder states
â”‚   â”‚   â””â”€â”€ settings/
â”‚   â”‚       â”œâ”€â”€ settings_bloc.dart     # App settings state
â”‚   â”‚       â”œâ”€â”€ settings_event.dart    # Settings events
â”‚   â”‚       â””â”€â”€ settings_state.dart    # Settings states
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”‚   â”œâ”€â”€ main_screen.dart       # Main folders view
â”‚   â”‚   â”‚   â””â”€â”€ main_screen_viewmodel.dart # Main screen logic
â”‚   â”‚   â”œâ”€â”€ recording/
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_screen.dart   # Active recording screen
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_list_screen.dart # List of recordings in folder
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_detail_screen.dart # Single recording details
â”‚   â”‚   â”‚   â””â”€â”€ recording_player_screen.dart # Full-screen player
â”‚   â”‚   â”œâ”€â”€ onboarding/
â”‚   â”‚   â”‚   â”œâ”€â”€ onboarding_screen.dart # App introduction
â”‚   â”‚   â”‚   â”œâ”€â”€ permission_screen.dart # Permission requests
â”‚   â”‚   â”‚   â””â”€â”€ welcome_screen.dart    # Welcome message
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”œâ”€â”€ settings_screen.dart   # App settings
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_settings_screen.dart # Audio quality settings
â”‚   â”‚   â”‚   â””â”€â”€ export_settings_screen.dart # Export preferences
â”‚   â”‚   â””â”€â”€ import/
â”‚   â”‚       â”œâ”€â”€ import_screen.dart     # File import interface
â”‚   â”‚       â””â”€â”€ file_browser_screen.dart # Browse and select files
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”œâ”€â”€ custom_button.dart     # Reusable button component
â”‚   â”‚   â”‚   â”œâ”€â”€ custom_dialog.dart     # Base dialog component
â”‚   â”‚   â”‚   â”œâ”€â”€ loading_indicator.dart # Loading spinner
â”‚   â”‚   â”‚   â”œâ”€â”€ empty_state.dart       # Empty list state
â”‚   â”‚   â”‚   â””â”€â”€ error_widget.dart      # Error display widget
â”‚   â”‚   â”œâ”€â”€ folder/
â”‚   â”‚   â”‚   â”œâ”€â”€ folder_item.dart       # Individual folder widget
â”‚   â”‚   â”‚   â”œâ”€â”€ folder_grid.dart       # Grid view of folders
â”‚   â”‚   â”‚   â””â”€â”€ folder_header.dart     # Folder section header
â”‚   â”‚   â”œâ”€â”€ recording/
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_item.dart    # Individual recording widget
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_list.dart    # List of recordings
â”‚   â”‚   â”‚   â”œâ”€â”€ waveform_widget.dart   # Audio waveform display
â”‚   â”‚   â”‚   â”œâ”€â”€ player_controls.dart   # Play/pause/seek controls
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_timer.dart   # Recording duration timer
â”‚   â”‚   â”‚   â””â”€â”€ audio_visualizer.dart  # Real-time recording visual
â”‚   â”‚   â”œâ”€â”€ dialogs/
â”‚   â”‚   â”‚   â”œâ”€â”€ create_folder_dialog.dart      # Create folder dialog âœ… MOVE YOUR EXISTING FILE HERE
â”‚   â”‚   â”‚   â”œâ”€â”€ audio_format_dialog.dart       # Select audio format âœ… MOVE YOUR EXISTING FILE HERE
â”‚   â”‚   â”‚   â”œâ”€â”€ recording_options_dialog.dart  # Recording settings
â”‚   â”‚   â”‚   â”œâ”€â”€ rename_dialog.dart             # Rename recording/folder
â”‚   â”‚   â”‚   â”œâ”€â”€ delete_confirmation_dialog.dart # Confirm delete action
â”‚   â”‚   â”‚   â””â”€â”€ export_options_dialog.dart     # Export format options
â”‚   â”‚   â””â”€â”€ inputs/
â”‚   â”‚       â”œâ”€â”€ search_bar.dart        # Search input field
â”‚   â”‚       â”œâ”€â”€ duration_slider.dart   # Audio position slider
â”‚   â”‚       â”œâ”€â”€ volume_slider.dart     # Volume control
â”‚   â”‚       â””â”€â”€ quality_selector.dart  # Audio quality picker
â”‚   â””â”€â”€ theme/
â”‚       â”œâ”€â”€ app_theme.dart            # App-wide theme definition
â”‚       â”œâ”€â”€ app_colors.dart           # Color palette
â”‚       â”œâ”€â”€ app_text_styles.dart      # Typography styles
â”‚       â””â”€â”€ app_dimensions.dart       # Spacing and sizing

# ==== SERVICES LAYER ====
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â”œâ”€â”€ audio_recorder_service.dart        # Audio recording implementation
â”‚   â”‚   â”œâ”€â”€ audio_player_service.dart          # Audio playback implementation
â”‚   â”‚   â”œâ”€â”€ audio_processor_service.dart       # Audio editing/conversion
â”‚   â”‚   â””â”€â”€ background_audio_service.dart      # Background recording
â”‚   â”œâ”€â”€ file/
â”‚   â”‚   â”œâ”€â”€ file_manager_service.dart          # File operations
â”‚   â”‚   â”œâ”€â”€ import_service.dart                # Import external files
â”‚   â”‚   â”œâ”€â”€ export_service.dart                # Export/share files
â”‚   â”‚   â””â”€â”€ metadata_service.dart              # Extract audio metadata
â”‚   â”œâ”€â”€ permission/
â”‚   â”‚   â”œâ”€â”€ permission_service.dart            # Handle permissions âœ… MOVE YOUR EXISTING permission_handler.dart HERE AND RENAME
â”‚   â”‚   â””â”€â”€ permission_handler.dart            # Permission UI logic
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ database_service.dart              # Database operations âœ… MOVE YOUR EXISTING folder_persistence_service.dart HERE AND RENAME
â”‚   â”‚   â”œâ”€â”€ file_storage_service.dart          # File system operations
â”‚   â”‚   â””â”€â”€ cache_service.dart                 # Temporary file cache
â”‚   â””â”€â”€ platform/
â”‚       â”œâ”€â”€ native_bridge_service.dart         # iOS native integration
â”‚       â”œâ”€â”€ files_app_service.dart             # Files app integration
â”‚       â””â”€â”€ sharing_service.dart               # System sharing sheet

# ==== CONFIGURATION ====
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ app_config.dart               # App configuration
â”‚   â”œâ”€â”€ database_config.dart          # Database configuration
â”‚   â”œâ”€â”€ audio_config.dart             # Audio settings configuration
â”‚   â””â”€â”€ dependency_injection.dart     # DI container setup

# ============================================
# FILES TO CREATE/MOVE MAPPING:
# ============================================

âœ… CREATE THESE NEW FILES:
â”œâ”€â”€ core/enums/folder_type.dart        # Move your FolderType enum here
â”œâ”€â”€ core/enums/audio_format.dart       # Move your AudioFormat enum here
â”œâ”€â”€ domain/entities/folder_entity.dart # Create new clean entity
â”œâ”€â”€ presentation/blocs/folder/folder_bloc.dart       # New Bloc implementation
â”œâ”€â”€ presentation/blocs/folder/folder_event.dart      # Bloc events (part of bloc file)
â”œâ”€â”€ presentation/blocs/folder/folder_state.dart      # Bloc states (part of bloc file)

ğŸ”„ MOVE YOUR EXISTING FILES:
â”œâ”€â”€ dialogs/create_folder_dialog.dart  â†’ presentation/widgets/dialogs/create_folder_dialog.dart
â”œâ”€â”€ dialogs/audio_format_dialog.dart   â†’ presentation/widgets/dialogs/audio_format_dialog.dart
â”œâ”€â”€ models/folder_model.dart           â†’ data/models/folder_model.dart
â”œâ”€â”€ services/folder_service.dart       â†’ services/storage/database_service.dart (rename and refactor)
â”œâ”€â”€ services/permission_handler.dart   â†’ services/permission/permission_service.dart (rename)
â”œâ”€â”€ widgets/voicememo_item.dart        â†’ presentation/widgets/folder/folder_item.dart (rename)
â”œâ”€â”€ voicememo_screen.dart              â†’ presentation/screens/main/main_screen.dart (refactor to use Bloc)

# ==== TECHNOLOGY STACK ====
State Management: flutter_bloc ^8.1.3       # âœ… Add to pubspec.yaml
Audio Recording: flutter_sound ^9.2.13      # Best quality, professional features
Audio Playback: just_audio ^0.9.36          # Excellent performance, many features
Database: sqflite ^2.3.0                    # âœ… You already have this
File Operations: path_provider ^2.1.1
Waveforms: audio_waveforms ^1.0.5            # Real-time visualization
Testing: mockito ^5.4.2, bloc_test ^9.1.4   # For comprehensive testing
Functional Programming: dartz ^0.10.1        # For Either<Failure, Success> pattern
Equality: equatable ^2.0.5                  # For Bloc state/event comparison